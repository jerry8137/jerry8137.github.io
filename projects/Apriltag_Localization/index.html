<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Object Detection and Localization by Apriltag | Chun-Yu "Jerry" Hou </title> <meta name="author" content="Chun-Yu " jerry hou> <meta name="description" content="NYCU Human Centric Computing Course Final Competition"> <meta name="keywords" content="robotics"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jerry8137.github.io/projects/Apriltag_Localization/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Chun-Yu "Jerry"</span> Hou </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Object Detection and Localization by Apriltag</h1> <p class="post-description">NYCU Human Centric Computing Course Final Competition</p> </header> <article> <h1 id="localization-by-apriltag">Localization by Apriltag</h1> <h2 id="demo-video"><a href="https://youtu.be/BF3L9FirbP4" rel="external nofollow noopener" target="_blank">Demo Video</a></h2> <iframe width="560" height="315" src="https://www.youtube.com/embed/BF3L9FirbP4?si=HAzF6W5fGLqNlKhb" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe> <p>===</p> <h2 id="team-molas-members">Team MOLA’s Members</h2> <ul> <li>0710809 侯俊宇(ECE) <a href="https://github.com/jerry8137" rel="external nofollow noopener" target="_blank">Github</a> </li> <li>0710715 呂宗翰(ECE) <a href="https://github.com/Lu-Zong-Han" rel="external nofollow noopener" target="_blank">Github</a> </li> <li>0710747 李謙熙(ECE) <a href="https://github.com/Jackie890621" rel="external nofollow noopener" target="_blank">Github</a> </li> <li>0710851 洪愷尹(ECE) <a href="https://github.com/KaiYin77" rel="external nofollow noopener" target="_blank">Github</a> </li> </ul> <h2 id="main-method-local-outlier-factor">Main Method: Local Outlier Factor</h2> <ol> <li> <strong>Calibrate</strong> the choosing point from the bounding box center, and <strong>filter out</strong> the low possibility detection from YOLO.</li> <li>Record the position of the specified objects.</li> <li> <strong>Remove the outliers</strong> and take <strong>average</strong> of the remaining as result.</li> </ol> <p>We use the Novelty detection with Local Outlier Factor provided by scikit-learn in order to remove the outliers. <a href="https://scikit-learn.org/stable/modules/outlier_detection.html" rel="external nofollow noopener" target="_blank">scikit-learn</a></p> <blockquote> <p>using the Local Outlier Factor</p> </blockquote> <pre><code class="language-python=">clf = LocalOutlierFactor(n_neighbors=(int)(len(a)/10)+2)
a_pred = clf.fit_predict(a)
</code></pre> <h2 id="engineering-problems-and-solving-techniques">Engineering Problems and Solving Techniques</h2> <h3 id="time-error-of-global-transformation">Time error of global transformation</h3> <p>Here we <strong>only depend on AprilTag</strong> for localization. Thus, while the camera cannot detect AprilTag, the localization will fail. The position of object we get is wrong if localization fails.</p> <p>We take advantage of transform time and local time.</p> <blockquote> <p>In apriltag_localization.cpp Record the time in header of the global transform</p> <pre><code class="language-python=">trans_odem.header.stamp = min_distance_trans.stamp_;
</code></pre> <p>time error = local time - transform time Check time error is small enough</p> </blockquote> <pre><code class="language-python=">if abs(local_time - transform_time) &lt; 1 and transform_time != 0:
     #implement object detection......
</code></pre> <h3 id="debugging-by-rviz">Debugging by RVIZ</h3> <p><strong>Publishing the ground truth</strong> in example bag and current robot position helps us observe the data. \</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/BF3L9FirbP4?si=OHeGIuDme7xUDiY6" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe> <blockquote> <p>Publish robot (camera_link) position</p> </blockquote> <pre><code class="language-python="># publish camera pos in origin frame
v1 = np.array([0,0,0,1])
org = np.matmul(global_transform, v1)
point_message = PointStamped()
point_message.header = depth_img.header
point_message.header.frame_id = "origin"
point_message.point.x = org[0]
point_message.point.y = org[1]
point_message.point.z = org[2]
pub1.publish(point_message)
print("pub camera")
</code></pre> <blockquote> <p>Publish object ground truth</p> </blockquote> <pre><code class="language-python="># put the ground truth here for rviz
point_message.point.x = 0
point_message.point.y = 3.924
point_message.point.z = 0.17
pub2.publish(point_message)
</code></pre> <h2 id="other-methods-weve-tried">Other Methods we’ve tried:</h2> <blockquote> <p>Since we found that object detection from yolov2-tiny(pre-train) is really unstable like false classification and miss detection so on</p> </blockquote> <p>Using moving average to get the global position</p> <ul> <li>Pros: Real time processing</li> <li>Cons: In terms of the bad detection, the average of wrong candidate positions is also the wrong position and if the scenario have the same class objects the outcome is also wrong. <pre><code class="language-python="> if len(Chair_avg) &gt;= 3: # !=0
           Chair[0] = 0
           Chair[1] = 0
           Chair[2] = 0
           for i in range(3):
               Chair[0] = Chair[0] + Chair_avg[-i-1][0]
               Chair[1] = Chair[1] + Chair_avg[-i-1][1]
               Chair[2] = Chair[2] + Chair_avg[-i-1][2]

           Chair[0] = Chair[0] / 3.0
           Chair[1] = Chair[1] / 3.0
           Chair[2] = Chair[2] / 3.0
</code></pre> <hr> </li> </ul> <blockquote> <p>Found that the chair case’s ground truth position is in the cushion center. However,the depth camera can only caluculate the depth of chair back, there has error over 20cm.</p> <ul> <li>Pros: Indeed, it solved this scenario.</li> <li>Cons: Not the general solution, for example, if the chair is back of the depth camera, it won’t work. <pre><code class="language-python=">zc = cv_depthimage2[int(y_chair)][int(x_chair)] - 200
</code></pre> <hr> </li> </ul> </blockquote> <blockquote> <p>Found that in umbrella case when camera is too close to umbrella the Yolo detection bounding box won’t include the whole umbrella, then the position of the umbrella will have an offset. Solution is to adopt the detection outcome by specific depth range.</p> <ul> <li>Pros: Indeed, it solved this scenario.</li> <li>Cons: Not the general solution, for example, if change to another bag, we should watch the bag on rviz to tune the parameter again. <pre><code class="language-python=">if Dist_Cam_Umbrella &lt; 2.3 and Dist_Cam_Umbrella &gt; 1.4 :
  publish_object_location(object_position, depth_img, org, Umbrella)
</code></pre> </li> </ul> </blockquote> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Chun-Yu "Jerry" Hou. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>